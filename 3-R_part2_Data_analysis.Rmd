---
title: "What i have"
output: html_notebook
---

Loading file
```{r message=FALSE, warning=FALSE}
Arthropods_genomes<-readr::read_csv("Arthropoda_genome_info_withTAXONOMY_06.06.csv")
```
```{r}
Arthropoda_genomes_firstperspp<-Arthropods_genomes %>% 
  filter(phylum=="Arthropoda") %>% 
  arrange(spp, sub.date ) %>% 
  group_by(spp) %>% 
  slice(1)
```

By sub.date
```{r}
Arthropods_genomes_firstperspp<-Arthropods_genomes %>% 
  filter(phylum=="Arthropoda") %>% 
  arrange(spp, sub.date ) %>% 
  group_by(spp) %>% 
  slice(1)
```


```{r}
table(Arthropods_genomes$assembly_category,useNA = "always")
table(Arthropods_genomes_firstperspp$assembly_category,useNA = "always")
```

How much have busco metadata
```{r}
table(Arthropods_genomes$busco_ver, useNA = "always")
```
3055-2804 = 251  busco with metadata
```{r}
table(Arthropods_genomes_firstperspp$order)
```
```{r}
by_order <- Arthropods_genomes_firstperspp %>% group_by(order) 
by_order <- filter(by_order, spp != "Xenocatantops brachycerus")
```


```{r}
xyz <- by_order %>% summarise(
  variation = var(seq_length/1000000000),
  n = n())
```


```{r}
xyz
```

```{r}
xyz[order(xyz$variation),]
```
```{r}
test <-Arthropods_genomes_firstperspp %>% 
  filter(order=="Orthoptera") %>% 
  arrange(seq_length)
```

```{r}
test
```


```{r}
something <- filter(by_order, order == "Orthoptera") 
something[order(something$seq_length),]
```

```{r}

library(lubridate)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(ggthemr)
library(scales)
library(stringr)

Arthropods_genomes$sub.date <- ymd(Arthropods_genomes$sub.date)
Arthropods_genomes$sub.date_formatted <- format(Arthropods_genomes$sub.date, "%Y/%m/%d")

xyz <- Arthropods_genomes %>% group_by(sub.date_formatted) %>% summarise(superkingdom = n())
xyz <- xyz %>%
  mutate(cumulative_quantity = cumsum(superkingdom))
xyz$sub.date_formatted <- ymd(xyz$sub.date_formatted)
xyz
```
```{r}
plot_years <- ggplot(xyz, aes(sub.date_formatted, cumulative_quantity )) + geom_line() +
  labs(
         x = "Year",
         y = "Number of genomes")+
         scale_x_date(date_breaks = "year",date_labels="%Y", expand=expansion(add=100))+
  theme(text=element_text(family="Arial", size=38))+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  geom_line(size=2)
plot_years
```

```{r}
a <- nrow(Arthropods_genomes)
b <- nrow(Arthropoda_genomes_firstperspp)
c <- nrow(subset(Arthropoda_genomes_firstperspp, GENOME_GFF_size > 1))
df <- data.frame(Genomes = c('All arthropoda genomes in NCBI databe', 'Unique arthropoda genomes in NCBI database', 'Unique arthropoda genomes with annotation in NCBI database'),Number= c(a,b,c))

```

```{r}
p<-ggplot(data=df, aes(x=Genomes, y=Number)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=Number), vjust=1.6, color="white", size=12)+
  theme(text=element_text(family="Arial", size=38))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.title.x = element_blank())
p
```
```{r}
ggsave(plot_years, file="2.svg", height=32, width=32, units="cm")
ggsave(p, file="3.svg", height=32, width=32, units="cm")
```




---------------------------------------------
Corelation test for genes
---------------------------------------------
```{r}
library("ggpubr")
my_data <- Arthropoda_genomes_firstperspp
my_data_2less <- Arthropoda_genomes_firstperspp %>%
  filter(seq_length < 5000000000)
```

```{r}
ggscatter(my_data, x = "seq_length", y = "gene_counts.total", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman",
          xlab = "Length of sequence", ylab = "Number of genes",use = "complete.obs")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)

```

```{r}
ggqqplot(my_data$seq_length, ylab = "Length of sequence")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
ggqqplot(my_data$gene_counts.total, ylab = "Number of genes")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
res <- cor.test(my_data$seq_length, my_data$gene_counts.total, 
                    method = "spearman")
res
```

---------------------------------------------
Corelation test for introns and exons
---------------------------------------------

```{r}
my_data_info <- readr::read_csv("Arthropoda_genome_info_withTAXONOMY_06.06+info.csv")
my_data_info_2less <- my_data_info %>%
  filter(seq_length < 5000000000)
```

-Exons

```{r}
ggscatter(my_data_info, x = "seq_length", y = "exon_count", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman",
          xlab = "Length of sequence", ylab = "Number of exons",use = "complete.obs")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
ggqqplot(my_data_info$seq_length, ylab = "Length of sequence")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
ggqqplot(my_data_info$exon_count, ylab = "Number of exons")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
res <- cor.test(my_data_info$seq_length, my_data_info$exon_count, 
                    method = "spearman")
res
```

-Introns

```{r}
ggscatter(my_data_info, x = "seq_length", y = "intron_count_calculated", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman",
          xlab = "Length of sequence", ylab = "Number of introns",use = "complete.obs")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
ggqqplot(my_data_info$seq_length, ylab = "Length of sequence")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
ggqqplot(my_data_info$intron_count_calculated, ylab = "Number of introns")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
res <- cor.test(my_data_info$seq_length, my_data_info$intron_count_calculated, 
                    method = "spearman")
res
```

-Introns original vs calculated

```{r}
introns_comaprison <- subset(my_data_info, intron_count_true > 1)
introns_comaprison
```

```{r}
introns_comaprison_longer <- introns_comaprison %>% tidyr::pivot_longer(cols=c("intron_count_true","intron_count_calculated"), values_to="Values", names_to = "intron_type")
introns_comaprison_longer
```

```{r}
ggplot(introns_comaprison_longer, aes(x = spp, y = Values)) + 
    geom_bar(aes(fill = intron_type),stat = "identity",position = "dodge")+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
 font("axis.title", size = 20)+
  font("axis.text", size = 12)+
  labs(x = "Species", y = "Number of introns")+
  scale_fill_discrete(name=NULL,
                         labels=c("Calculated introns","Oryginal introns"))

```
-Introns means

```{r}
ggscatter(my_data_info, x = "seq_length", y = "intron_length_calculated_mean", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman",
          xlab = "Length of sequence", ylab = "Mean intron lengths",use = "complete.obs")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
ggqqplot(my_data_info$seq_length, ylab = "Length of sequence")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
ggqqplot(my_data_info$intron_length_calculated_mean, ylab = "Mean intron lengths")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
res <- cor.test(my_data_info$seq_length, my_data_info$intron_length_calculated_mean, 
                    method = "spearman")
res
```

-Introns sum

```{r}
ggscatter(my_data_info, x = "seq_length", y = "intron_length_calculated_sum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman",
          xlab = "Length of sequence", ylab = "Sum of intron lengths",use = "complete.obs")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
ggqqplot(my_data_info$seq_length, ylab = "Length of sequence")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
ggqqplot(my_data_info$intron_length_calculated_sum, ylab = "Sum of intron lengths")+
 font("axis.title", size = 20)+
  font("axis.text", size = 16)
```

```{r}
res <- cor.test(my_data_info$seq_length, my_data_info$intron_length_calculated_sum, 
                    method = "spearman")
res
```

```{r}
sessionInfo()
```










